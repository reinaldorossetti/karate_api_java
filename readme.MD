# ğŸ¥‹ Karate API Testing - ServeRest

[![Karate](https://img.shields.io/badge/Karate-1.5.2-blue.svg)](https://github.com/karatelabs/karate)
[![JUnit5](https://img.shields.io/badge/JUnit-5.10.1-green.svg)](https://junit.org/junit5/)
[![Java](https://img.shields.io/badge/Java-21-orange.svg)](https://www.oracle.com/java/)

Projeto de automaÃ§Ã£o de testes de API utilizando **Karate Framework** para testar a API REST **ServeRest** - uma API gratuita que simula uma loja virtual.

Projeto estruturado com boas prÃ¡ticas, exemplos de testes, validaÃ§Ãµes avanÃ§adas e integraÃ§Ã£o com JUnit 5 para execuÃ§Ã£o e relatÃ³rios.

URI do repositÃ³rio: [https://github.com/reinaldorossetti/karate_api_java](https://github.com/reinaldorossetti/karate_api_java)

Reporte na esteira: [https://reinaldorossetti.github.io/karate_api_java/karate-reports/karate-summary.html](https://reinaldorossetti.github.io/karate_api_java/karate-reports/karate-summary.html)

---

## ğŸ“š Ãndice

- [Sobre o Karate Framework](#-sobre-o-karate-framework)
- [Sobre a API ServeRest](#-sobre-a-api-serverest)
- [Estrutura do Projeto](#-estrutura-do-projeto)
- [PrÃ©-requisitos](#-prÃ©-requisitos)
- [InstalaÃ§Ã£o](#-instalaÃ§Ã£o)
- [Executando os Testes](#-executando-os-testes)
- [Exemplos de Testes](#-exemplos-de-testes)
- [Funcionalidades do Karate](#-funcionalidades-do-karate)
- [RelatÃ³rios](#-relatÃ³rios)
- [Boas PrÃ¡ticas](#-boas-prÃ¡ticas)
- [Recursos Adicionais](#-recursos-adicionais)

---

## ğŸ¥‹ Sobre o Karate Framework

**Karate** Ã© um framework open-source que unifica testes de API, mocks, testes de performance e atÃ© mesmo automaÃ§Ã£o de UI em uma Ãºnica estrutura poderosa e fÃ¡cil de usar.

### âœ¨ Principais CaracterÃ­sticas

- **ğŸ”¥ Sem necessidade de cÃ³digo Java**: Escreva testes usando uma sintaxe simples baseada em Gherkin
- **ğŸš€ Testes de API REST e SOAP**: Suporte completo para HTTP, JSON, XML, GraphQL
- **ğŸ¯ Built-in para Assertions**: ValidaÃ§Ãµes poderosas e expressivas sem bibliotecas adicionais
- **ğŸ”„ ReutilizaÃ§Ã£o de cÃ³digo**: Chamadas entre features, funÃ§Ãµes JavaScript customizadas
- **ğŸ“Š RelatÃ³rios HTML**: RelatÃ³rios detalhados e visuais automaticamente gerados
- **ğŸ§ª Data-Driven Testing**: Suporte nativo para testes orientados a dados
- **ğŸ­ Mock Server**: Crie mocks de APIs facilmente
- **âš¡ ExecuÃ§Ã£o Paralela**: Execute testes em paralelo para maior velocidade
- **ğŸ” AutenticaÃ§Ã£o**: Suporte para OAuth, JWT, cookies e headers customizados

### ğŸ’¡ Por que usar Karate?

1. **Produtividade**: Escreva testes complexos de forma simples e legÃ­vel
2. **Manutenibilidade**: Testes fÃ¡ceis de entender e manter
3. **Completude**: Tudo que vocÃª precisa em um Ãºnico framework
4. **Comunidade ativa**: Bem documentado e com suporte ativo
5. **IntegraÃ§Ã£o CI/CD**: FÃ¡cil integraÃ§Ã£o com Jenkins, GitLab CI, GitHub Actions, etc.

---

## ğŸŒ Sobre a API ServeRest

[ServeRest](https://serverest.dev/) Ã© uma API REST gratuita que simula uma loja virtual para fins educacionais e prÃ¡tica de testes de API.

### ğŸ›ï¸ Endpoints DisponÃ­veis

| Recurso | Endpoints | DescriÃ§Ã£o |
|---------|-----------|-----------|
| **Login** | `POST /login` | AutenticaÃ§Ã£o de usuÃ¡rios |
| **UsuÃ¡rios** | `GET, POST, PUT, DELETE /usuarios` | Gerenciamento de usuÃ¡rios |
| **Produtos** | `GET, POST, PUT, DELETE /produtos` | Gerenciamento de produtos (requer admin) |
| **Carrinhos** | `GET, POST, DELETE /carrinhos` | Gerenciamento de carrinhos de compras |

### ğŸ”— Base URL

```
https://serverest.dev
```

### ğŸ“– DocumentaÃ§Ã£o Completa

- **Swagger UI**: https://serverest.dev/
- **RepositÃ³rio**: https://github.com/ServeRest/ServeRest
- **Front-end (Beta)**: https://front.serverest.dev/

---

## ğŸ“ Estrutura do Projeto

```
karate_api_java/
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â””â”€â”€ java/                         # (vazio neste projeto)
â”‚   â”‚
â”‚   â””â”€â”€ test/
â”‚       â””â”€â”€ java/
â”‚           â”œâ”€â”€ karate-config.js          # ConfiguraÃ§Ã£o global do Karate
â”‚           â”œâ”€â”€ logback-test.xml          # ConfiguraÃ§Ã£o de logs
â”‚           â”œâ”€â”€ ParallelRunner.java       # ExecuÃ§Ã£o paralela centralizada (JUnit 5)
â”‚           â”‚
â”‚           â”œâ”€â”€ karate/                   # Exemplos oficiais do Karate
â”‚           â”‚   â””â”€â”€ samples/
â”‚           â”‚       â”œâ”€â”€ sample.feature
â”‚           â”‚       â”œâ”€â”€ SampleTest.java
â”‚           â”‚       â”œâ”€â”€ customTags.feature
â”‚           â”‚       â”œâ”€â”€ SampleCustomTagsTest.java
â”‚           â”‚       â”œâ”€â”€ embed.feature
â”‚           â”‚       â”œâ”€â”€ noFeatureNoScenario.feature
â”‚           â”‚       â””â”€â”€ ...
â”‚           â”‚
â”‚           â””â”€â”€ serverest/                # Testes da API ServeRest
â”‚               â”œâ”€â”€ usuarios/
â”‚               â”‚   â”œâ”€â”€ Users.feature
â”‚               â”‚   â”œâ”€â”€ UsersTest.java
â”‚               â”‚   â””â”€â”€ resources/
â”‚               â”‚       â””â”€â”€ userPayload.json
â”‚               â”œâ”€â”€ produtos/
â”‚               â”‚   â”œâ”€â”€ Products.feature
â”‚               â”‚   â”œâ”€â”€ ProductsTest.java
â”‚               â”‚   â””â”€â”€ resources/
â”‚               â”‚       â””â”€â”€ productPayload.json
â”‚               â”œâ”€â”€ login/
â”‚               â”‚   â”œâ”€â”€ Login.feature
â”‚               â”‚   â”œâ”€â”€ LoginTest.java
â”‚               â”‚   â””â”€â”€ resources/
â”‚               â”‚       â””â”€â”€ loginPayload.json
â”‚               â””â”€â”€ utils/
â”‚                   â””â”€â”€ FakerUtils.java
â”‚
â”œâ”€â”€ pom.xml                               # DependÃªncias Maven
â””â”€â”€ README.md                             # Este arquivo
```

---

## ğŸ”§ PrÃ©-requisitos

- **Java JDK 21** (LTS) ou superior
- **Maven 3.6+**
- **IDE** (IntelliJ IDEA, Eclipse, VS Code)
- ConexÃ£o com internet (para acessar a API ServeRest)

### Download do Java 21

- Oracle JDK 21: https://www.oracle.com/java/technologies/downloads/#java21

### Verificar instalaÃ§Ã£o

```bash
java -version
mvn -version
```

---

## ğŸ“¦ VersÃµes das dependÃªncias (pom.xml)

| Componente                         | Artefato                                      | VersÃ£o  |
|------------------------------------|-----------------------------------------------|---------|
| Karate Core                        | io.karatelabs:karate-core                     | 1.5.2   |
| Karate JUnit5                      | io.karatelabs:karate-junit5                   | 1.5.2   |
| JUnit 5 (Jupiter API)             | org.junit.jupiter:junit-jupiter-api           | 5.10.1  |
| JUnit 5 (Jupiter Engine)          | org.junit.jupiter:junit-jupiter-engine        | 5.10.1  |
| Maven Surefire Plugin             | org.apache.maven.plugins:maven-surefire-plugin| 3.2.5   |
| Maven Compiler Plugin             | org.apache.maven.plugins:maven-compiler-plugin| 3.11.0  |

---

## ğŸš€ InstalaÃ§Ã£o

### 1. Clone o repositÃ³rio

```bash
git clone https://github.com/reinaldorossetti/karate_api_java.git
cd karate_api_java
```

### 2. Instale as dependÃªncias

```bash
mvn clean install
```

### 3. Verifique a instalaÃ§Ã£o

```bash
mvn test
```

---

## â–¶ï¸ Executando os Testes

### Executar todos os testes

```bash
mvn test
```

### Executar suÃ­te principal (ParallelRunner)

O `ParallelRunner` Ã© uma classe de teste JUnit 5 que executa as features em paralelo, filtrando por tags (ex.: `@regression`) e gerando relatÃ³rios em `target/karate-reports`.

```bash
mvn test -Dtest=ParallelRunner
```

```java
class ParallelRunner {

    @Test
    void testParallel() {
        Results results = Runner.path("classpath:serverest")
                .tags("~@ignore", "@regression")
                .outputJunitXml(true)          // Jenkins/CI integration
                .outputCucumberJson(true)      // Dashboard integration
                .reportDir("target/karate-reports")
                .parallel(6);  // 6 threads
        assertEquals(0, results.getFailCount(), results.getErrorMessages());
    }

}
```

### Executar por uma funÃ§Ã£o especÃ­fica, usando da funÃ§Ã£o

```bash
# Run specific test method
mvn test -Dtest=UserTest#testSmokeTests
```

---

## âš™ï¸ Esteira CI/CD - GitHub Actions

Este projeto possui integraÃ§Ã£o contÃ­nua configurada no GitHub Actions em:

- Arquivo: `.github/workflows/api-tests.yml`

### ğŸ” Quando a esteira Ã© executada

- `push` em qualquer branch
- `pull_request` aberto ou atualizado

### ğŸ§± Passos principais do job `test`

1. **Checkout do cÃ³digo**
  - `actions/checkout@v4`
2. **ConfiguraÃ§Ã£o do Java 21**
  - `actions/setup-java@v5` com:
    - `java-version: '21'`
    - `distribution: 'temurin'`
3. **ExecuÃ§Ã£o dos testes Karate via Maven**
  - Comando: `mvn test -Dtest=ParallelRunner`
  - Usa a classe `ParallelRunner` para executar as features em paralelo, filtrando cenÃ¡rios (ex.: `@regression`).
4. **PublicaÃ§Ã£o de relatÃ³rios do Karate**
  - Publica `target/karate-reports` via `peaceiris/actions-gh-pages@v4` na branch `gh-pages`, pasta `karate-reports`.

### ğŸŒ Acesso ao relatÃ³rio no GitHub Pages

ApÃ³s a execuÃ§Ã£o da esteira (branch padrÃ£o configurada no repositÃ³rio):

- URL do relatÃ³rio: 
  - `https://reinaldorossetti.github.io/karate_api_java/karate-reports/karate-summary.html`

Certifique-se de que nas **Settings â†’ Pages** do repositÃ³rio o GitHub Pages esteja apontando para a branch `gh-pages`.

---

## ğŸ“ Exemplos de Testes

### Exemplo 1: Listar UsuÃ¡rios (GET)

**Feature**: `src/test/java/serverest/usuarios/Users.feature`

```gherkin
@users
Feature: User Management - ServeRest API

  Background:
    * url 'https://serverest.dev'
    * def FakerUtils = Java.type('serverest.utils.FakerUtils')
    * def randomEmail = function(){ return FakerUtils.randomEmail() }
    * def randomName = function(){ return FakerUtils.randomName() }
    * def randomPassword = function(){ return FakerUtils.randomPassword() }

  @list @smoke @regression
  Scenario: CT01 - List all users and validate JSON structure
    Given path '/usuarios'
    When method GET
    Then status 200
    And match response.quantidade == '#number? _ > 0'
    And match each response.usuarios ==  
      """
      {
        nome: '#string',
        email: '#regex .+@.+\\..+',
        password: '#string',
        administrador: '#string',
        _id: '#string'
      }
      """
```

### Exemplo 2: Cadastrar UsuÃ¡rio (POST)

```gherkin
  @create @smoke @regression
  Scenario: CT03 - Create a new user with complete validations
    * def newEmail = randomEmail()
    * def name = randomName()
    * def password = randomPassword()
    * def userData =
      """
      {
        "nome": "#(name)",
        "email": "#(newEmail)",
        "password": "#(password)",
        "administrador": "true"
      }
      """
    
    Given path '/usuarios'
    And request userData
    When method POST
    Then status 201
    And match response.message == 'Cadastro realizado com sucesso'
    And match response._id == '#string'
```

### Exemplo 3: Login e AutenticaÃ§Ã£o

**Feature**: `src/test/java/serverest/login/Login.feature`

```gherkin
@login
Feature: User Authentication - Login

  Background:
    * url 'https://serverest.dev'
    * def FakerUtils = Java.type('serverest.utils.FakerUtils')
    * def randomProductName = function(){ return FakerUtils.randomProduct() }

  @regression @smoke @login-success
  Scenario: CT01 - Perform login with valid credentials and validate token
    * def loginPayload = read('classpath:serverest/login/resources/loginPayload.json')
    Given path '/login'
    And request loginPayload
    When method POST
    Then status 200
    * def message = response.message
    * def authToken = response.authorization

    And match message == 'Login realizado com sucesso'
    And match authToken == '#notnull'
    And match authToken == '#? _.length > 50'
```

### Exemplo 4: Testes com AutenticaÃ§Ã£o (Produtos)

**Feature**: `src/test/java/serverest/produtos/Products.feature`

```gherkin
@products
Feature: Product Management (Requires Admin Authentication)

  Background:
    * url 'https://serverest.dev'
    * def loginResponse = call read('classpath:serverest/login/Login.feature@reusable-login')
    * def token = loginResponse.token

  @create-product @smoke
  Scenario: Create a new product as an administrator
    * def productName = 'Product ' + new Date().getTime()
    * def productData =
      """
      {
        "nome": "#(productName)",
        "preco": 250,
        "descricao": "Automated test product",
        "quantidade": 100
      }
      """

    Given path '/products'
    And header Authorization = token
    And request productData
    When method POST
    Then status 201
```

### Exemplo 5: Data-Driven Testing

```gherkin
  @regression
  Scenario Outline: CT03 - Validate required fields on login
    * def incompleteData =
      """
      {
        "email": "<email>",
        "password": "<password>"
      }
      """
    
    Given path '/login'
    And request incompleteData
    When method POST
    Then status 400
    * if (!incompleteData.email) karate.match(response, { email: '#string' })
    * if (!incompleteData.password) karate.match(response, { password: '#string' })
    
    Examples:
      | email          | password |
      |                | senha123 |
      | test@email.com |          |
      |                |          |
```

### Exemplo 6: ValidaÃ§Ãµes avanÃ§adas com filtros (Users)

**Feature**: `src/test/java/serverest/usuarios/Users.feature`

```gherkin
  @advanced-validations @regression
  Scenario: CT04 - Advanced JSON validations with filters
    Given path '/usuarios'
    When method GET
    Then status 200
    
    * def admins = karate.filter(response.usuarios, function(x){ return x.administrador == 'true' })
    * print 'Total administrators:', admins.length
```

---

## ğŸ¯ Funcionalidades do Karate

### 1. ConfiguraÃ§Ã£o Global (karate-config.js)

```javascript
function fn() {
  var config = {
    baseUrl: 'https://serverest.dev',
    timeout: 10000
    * url 'https://serverest.dev'
    * def loginResponse = call read('classpath:serverest/login/Login.feature@login-success')
    * def token = loginResponse.authToken
    * def randomName = function(){ return 'Product ' + new Date().getTime() }

  @create-product @smoke @regression
  Scenario: CT02 - Create a new product as an administrator
    * def productName = randomName()
    * def productData =
      """
      {
        "nome": "#(productName)",
        "preco": 250,
        "descricao": "Automated test product",
        "quantidade": 100
      }
      """

      Given path '/produtos'
    And header Authorization = token
    And request productData
    When method POST
    Then status 201
# Validar cada item do array
And match each response.usuarios contains { nome: '#string' }

# Validar com regex
And match response.email == '#regex .+@.+\\..+'

# Validar presenÃ§a de campos
And match response contains { message: '#string', _id: '#string' }

# Validar ausÃªncia de campo
And match response !contains { error: '#string' }
```

### 3. VariÃ¡veis e ReutilizaÃ§Ã£o

```gherkin
# Definir variÃ¡vel
* def userId = response._id

# String concatenation
* def fullUrl = baseUrl + '/usuarios/' + userId

# Random data
* def randomEmail = 'teste' + karate.randomString(5) + '@email.com'

# Chamar outra feature
* def loginResult = call read('login.feature')
* def token = loginResult.token
```

### 4. Hooks e Setup

```gherkin
Background:
  * url baseUrl
  * configure headers = { 'Content-Type': 'application/json' }
  * configure connectTimeout = 5000
  * configure readTimeout = 5000
```

---

## ğŸ“Š RelatÃ³rios

ApÃ³s executar os testes, relatÃ³rios HTML sÃ£o gerados automaticamente:

```
target/karate-reports/karate-summary.html
```

Abra o arquivo no navegador para visualizar:
- âœ… Testes executados, passados e falhos
- â±ï¸ Tempo de execuÃ§Ã£o
- ğŸ“¸ Screenshots (se configurado)
- ğŸ“‹ Logs detalhados de cada cenÃ¡rio

---

## ğŸ“ Boas PrÃ¡ticas

### 1. OrganizaÃ§Ã£o de Features

- âœ… Uma feature por recurso (usuarios.feature, produtos.feature)
- âœ… Use Background para configuraÃ§Ãµes comuns
- âœ… Nomeie scenarios de forma descritiva

### 2. Tags para OrganizaÃ§Ã£o

```gherkin
@smoke     # Testes crÃ­ticos de smoke
@regression # Suite de regressÃ£o completa
@usuarios   # Testes de usuÃ¡rios
@ignore    # Temporariamente desabilitado
```

### 3. ReutilizaÃ§Ã£o de CÃ³digo

- âœ… Crie features reutilizÃ¡veis (ex: login.feature)
- âœ… Use funÃ§Ãµes JavaScript no karate-config.js
- âœ… Extraia dados comuns para variÃ¡veis

### 4. Dados de Teste

```gherkin
# Gerar dados dinÃ¢micos
* def timestamp = new Date().getTime()
* def randomEmail = 'user' + timestamp + '@test.com'

# Evitar dados estÃ¡ticos que podem causar conflitos
```

### 5. ValidaÃ§Ãµes Completas

```gherkin
# Sempre valide:
- Status code
- Schema da resposta
- Mensagens de erro
- Headers importantes
```

---

## ğŸ“š Recursos Adicionais

### DocumentaÃ§Ã£o Oficial

- ğŸ¥‹ **Karate**: https://github.com/karatelabs/karate
- ğŸŒ **ServeRest**: https://serverest.dev/
- â˜• **JUnit 5**: https://junit.org/junit5/

### Tutoriais e Cursos

- [Karate DSL Official Documentation](https://karatelabs.github.io/karate/)
- [Karate Examples on GitHub](https://github.com/karatelabs/karate/tree/master/karate-demo)
- [ServeRest GitHub](https://github.com/ServeRest/ServeRest)

### Comunidade

- [Karate Slack Community](https://karate-dsl.slack.com)
- [Stack Overflow - Karate Tag](https://stackoverflow.com/questions/tagged/karate)

---

## ğŸ¤ Contribuindo

ContribuiÃ§Ãµes sÃ£o bem-vindas! Para contribuir:

1. Fork o projeto
2. Crie uma branch para sua feature (`git checkout -b feature/MinhaFeature`)
3. Commit suas mudanÃ§as (`git commit -m 'Adiciona nova feature'`)
4. Push para a branch (`git push origin feature/MinhaFeature`)
5. Abra um Pull Request

---

## ğŸ“„ LicenÃ§a

Este projeto estÃ¡ sob a licenÃ§a MIT. Veja o arquivo [LICENSE](LICENSE) para mais detalhes.

---

## ğŸ‘¨â€ğŸ’» Autor

Desenvolvido para fins de estudo e prÃ¡tica de automaÃ§Ã£o de testes de API.

---

## â­ Agradecimentos

- **Paulo GonÃ§alves** - Criador da API ServeRest
- **Peter Thomas** - Criador do Karate Framework
- Comunidade open-source

---
ReferÃªncias:
- https://github.com/karatelabs/karate
- https://junit.org/junit5/ 
- https://docs.karatelabs.io/running-tests/parallel-execution

**ğŸš€ Happy Testing!** ğŸ¥‹
