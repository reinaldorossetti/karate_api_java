<testsuite failures="2" name="serverest/carrinhos/Carts.feature" skipped="0" tests="8" time="13.084543"><testcase classname="serverest.carrinhos.Carts" name="CT01 - Full cart lifecycle for authenticated user" time="2.331642"><system-out>* url 'https://serverest.dev' ............................................. passed
* def FakerUtils = Java.type('serverest.utils.FakerUtils') ................ passed
* def randomProductName = function(){ return FakerUtils.randomProduct() } . passed
* def loginPayload = read('classpath:serverest/login/resources/loginPayload.json') . passed
* def email = function(){ return FakerUtils.randomEmail() } ............... passed
* def userEmail = email() ................................................. passed
* def userPassword = 'SenhaSegura@123' .................................... passed
* def newUser = ........................................................... passed
Given path '/usuarios' .................................................... passed
And request newUser ....................................................... passed
When method POST .......................................................... passed
Then status 201 ........................................................... passed
* set loginPayload.email = userEmail ...................................... passed
* set loginPayload.password = userPassword ................................ passed
Given path '/login' ....................................................... passed
And request loginPayload .................................................. passed
When method POST .......................................................... passed
Then status 200 ........................................................... passed
* def token = response.authorization ...................................... passed
Given path '/carrinhos/cancelar-compra' ................................... passed
And header Authorization = token .......................................... passed
When method DELETE ........................................................ passed
Then status 200 ........................................................... passed
* def productName = randomProductName() ................................... passed
* def productData = ....................................................... passed
Given path '/produtos' .................................................... passed
And header Authorization = token .......................................... passed
And request productData ................................................... passed
When method POST .......................................................... passed
Then status 201 ........................................................... passed
And match response.message == 'Cadastro realizado com sucesso' ............ passed
* def productId = response._id ............................................ passed
* def cartBody = .......................................................... passed
Given path '/carrinhos' ................................................... passed
And header Authorization = token .......................................... passed
And request cartBody ...................................................... passed
When method POST .......................................................... passed
Then status 201 ........................................................... passed
And match response.message == 'Cadastro realizado com sucesso' ............ passed
And match response._id == '#string' ....................................... passed
* def cartId = response._id ............................................... passed
Given path '/carrinhos/' + cartId ......................................... passed
When method GET ........................................................... passed
Then status 200 ........................................................... passed
And match response == ..................................................... passed
Given path '/carrinhos/concluir-compra' ................................... passed
And header Authorization = token .......................................... passed
When method DELETE ........................................................ passed
Then status 200 ........................................................... passed
And match response.message contains 'Registro excluído com sucesso' ....... passed
</system-out></testcase>
<testcase classname="serverest.carrinhos.Carts" name="CT02 - Cancel purchase and return products to stock" time="2.290454"><system-out>* url 'https://serverest.dev' ............................................. passed
* def FakerUtils = Java.type('serverest.utils.FakerUtils') ................ passed
* def randomProductName = function(){ return FakerUtils.randomProduct() } . passed
* def loginPayload = read('classpath:serverest/login/resources/loginPayload.json') . passed
* def email = function(){ return FakerUtils.randomEmail() } ............... passed
Given path '/login' ....................................................... passed
And request loginPayload .................................................. passed
When method POST .......................................................... passed
Then status 200 ........................................................... passed
* def token = response.authorization ...................................... passed
Given path '/carrinhos/cancelar-compra' ................................... passed
And header Authorization = token .......................................... passed
When method DELETE ........................................................ passed
Then status 200 ........................................................... passed
* def productName = randomProductName() ................................... passed
* def productData = ....................................................... passed
Given path '/produtos' .................................................... passed
* print 'Using auth token:', token ........................................ passed
And header Authorization = token .......................................... passed
And request productData ................................................... passed
When method POST .......................................................... passed
Then status 201 ........................................................... passed
* def productId = response._id ............................................ passed
* def cartBody = .......................................................... passed
Given path '/carrinhos' ................................................... passed
And header Authorization = token .......................................... passed
And request cartBody ...................................................... passed
When method POST .......................................................... passed
Then status 201 ........................................................... passed
Given path '/carrinhos/cancelar-compra' ................................... passed
And header Authorization = token .......................................... passed
When method DELETE ........................................................ passed
Then status 200 ........................................................... passed
And match response.message == '#string' ................................... passed
</system-out></testcase>
<testcase classname="serverest.carrinhos.Carts" name="CT03 - Prevent creating cart without authentication token" time="0.970472"><system-out>* url 'https://serverest.dev' ............................................. passed
* def FakerUtils = Java.type('serverest.utils.FakerUtils') ................ passed
* def randomProductName = function(){ return FakerUtils.randomProduct() } . passed
* def loginPayload = read('classpath:serverest/login/resources/loginPayload.json') . passed
* def email = function(){ return FakerUtils.randomEmail() } ............... passed
* def cartBody = .......................................................... passed
Given path '/carrinhos' ................................................... passed
And request cartBody ...................................................... passed
When method POST .......................................................... passed
Then status 401 ........................................................... passed
And match response.message == 'Token de acesso ausente, inválido, expirado ou usuário do token não existe mais' . passed
</system-out></testcase>
<testcase classname="serverest.carrinhos.Carts" name="CT04 - Prevent creating more than one cart for the same user" time="2.212349"><system-out>* url 'https://serverest.dev' ............................................. passed
* def FakerUtils = Java.type('serverest.utils.FakerUtils') ................ passed
* def randomProductName = function(){ return FakerUtils.randomProduct() } . passed
* def loginPayload = read('classpath:serverest/login/resources/loginPayload.json') . passed
* def email = function(){ return FakerUtils.randomEmail() } ............... passed
* def loginPayload = read('classpath:serverest/login/resources/loginPayload.json') . passed
Given path '/login' ....................................................... passed
And request loginPayload .................................................. passed
When method POST .......................................................... passed
Then status 200 ........................................................... passed
* def token = response.authorization ...................................... passed
Given path '/carrinhos/cancelar-compra' ................................... passed
And header Authorization = token .......................................... passed
When method DELETE ........................................................ passed
Then status 200 ........................................................... passed
* def productName = randomProductName() ................................... passed
* def productData = ....................................................... passed
Given path '/produtos' .................................................... passed
And header Authorization = token .......................................... passed
And request productData ................................................... passed
When method POST .......................................................... passed
Then status 201 ........................................................... passed
* def productId = response._id ............................................ passed
* def firstCart = ......................................................... passed
Given path '/carrinhos' ................................................... passed
And header Authorization = token .......................................... passed
And request firstCart ..................................................... passed
When method POST .......................................................... passed
Then status 201 ........................................................... passed
* def secondCart = firstCart .............................................. passed
Given path '/carrinhos' ................................................... passed
And header Authorization = token .......................................... passed
And request secondCart .................................................... passed
When method POST .......................................................... passed
Then status 400 ........................................................... passed
And match response.message contains 'Não é permitido ter mais de 1 carrinho' . passed
</system-out></testcase>
<testcase classname="serverest.carrinhos.Carts" name="CT05 - Cart not found by ID" time="0.877279"><system-out>* url 'https://serverest.dev' ............................................. passed
* def FakerUtils = Java.type('serverest.utils.FakerUtils') ................ passed
* def randomProductName = function(){ return FakerUtils.randomProduct() } . passed
* def loginPayload = read('classpath:serverest/login/resources/loginPayload.json') . passed
* def email = function(){ return FakerUtils.randomEmail() } ............... passed
Given path '/carrinhos/invalid-cart-id-123' ............................... passed
When method GET ........................................................... passed
Then status 400 ........................................................... passed
And match response == { id: 'id deve ter exatamente 16 caracteres alfanuméricos' } . passed
</system-out></testcase>
<testcase classname="serverest.carrinhos.Carts" name="CT06 - Prevent cart creation when product stock is insufficient" time="2.185273"><failure message="match failed: CONTAINS&#10;  $ | actual does not contain expected (STRING:STRING)&#10;  'Não é permitido ter mais de 1 carrinho'&#10;  'Produto não possui quantidade suficiente'&#10;&#10;classpath:serverest/carrinhos/Carts.feature:312">* url 'https://serverest.dev' ............................................. passed
* def FakerUtils = Java.type('serverest.utils.FakerUtils') ................ passed
* def randomProductName = function(){ return FakerUtils.randomProduct() } . passed
* def loginPayload = read('classpath:serverest/login/resources/loginPayload.json') . passed
* def email = function(){ return FakerUtils.randomEmail() } ............... passed
* def loginPayload = read('classpath:serverest/login/resources/loginPayload.json') . passed
Given path '/login' ....................................................... passed
And request loginPayload .................................................. passed
When method POST .......................................................... passed
Then status 200 ........................................................... passed
* def token = response.authorization ...................................... passed
Given path '/carrinhos/cancelar-compra' ................................... passed
And header Authorization = token .......................................... passed
When method DELETE ........................................................ passed
Then status 200 ........................................................... passed
* def productName = randomProductName() ................................... passed
* def productData = ....................................................... passed
Given path '/produtos' .................................................... passed
And header Authorization = token .......................................... passed
And request productData ................................................... passed
When method POST .......................................................... passed
Then status 201 ........................................................... passed
* def productId = response._id ............................................ passed
* def cartBody = .......................................................... passed
Given path '/carrinhos' ................................................... passed
And header Authorization = token .......................................... passed
And request cartBody ...................................................... passed
When method POST .......................................................... passed
Then status 400 ........................................................... passed
And match response.message contains 'Produto não possui quantidade suficiente' . failed

Stack Trace:
com.intuit.karate.KarateException: match failed: CONTAINS
  $ | actual does not contain expected (STRING:STRING)
  'Não é permitido ter mais de 1 carrinho'
  'Produto não possui quantidade suficiente'

classpath:serverest/carrinhos/Carts.feature:312
	at &lt;feature&gt;.: And match response.message contains 'Produto não possui quantidade suficiente' (classpath:serverest/carrinhos/Carts.feature:312:312)

</failure></testcase>
<testcase classname="serverest.carrinhos.Carts" name="CT07 - Prevent cart creation with duplicated products in the same cart" time="1.298012"><failure message="match failed: CONTAINS&#10;  $ | actual does not contain expected (STRING:STRING)&#10;  'Não é permitido ter mais de 1 carrinho'&#10;  'Não é permitido possuir produto duplicado'&#10;&#10;classpath:serverest/carrinhos/Carts.feature:370">* url 'https://serverest.dev' ............................................. passed
* def FakerUtils = Java.type('serverest.utils.FakerUtils') ................ passed
* def randomProductName = function(){ return FakerUtils.randomProduct() } . passed
* def loginPayload = read('classpath:serverest/login/resources/loginPayload.json') . passed
* def email = function(){ return FakerUtils.randomEmail() } ............... passed
* def loginPayload = read('classpath:serverest/login/resources/loginPayload.json') . passed
Given path '/login' ....................................................... passed
And request loginPayload .................................................. passed
When method POST .......................................................... passed
Then status 200 ........................................................... passed
* def token = response.authorization ...................................... passed
Given path '/carrinhos/cancelar-compra' ................................... passed
And header Authorization = token .......................................... passed
When method DELETE ........................................................ passed
Then status 200 ........................................................... passed
* def productName = randomProductName() ................................... passed
* def productData = ....................................................... passed
Given path '/produtos' .................................................... passed
And header Authorization = token .......................................... passed
And request productData ................................................... passed
When method POST .......................................................... passed
Then status 201 ........................................................... passed
* def productId = response._id ............................................ passed
* def duplicatedCartBody = ................................................ passed
Given path '/carrinhos' ................................................... passed
And header Authorization = token .......................................... passed
And request duplicatedCartBody ............................................ passed
When method POST .......................................................... passed
Then status 400 ........................................................... passed
And match response.message contains 'Não é permitido possuir produto duplicado' . failed

Stack Trace:
com.intuit.karate.KarateException: match failed: CONTAINS
  $ | actual does not contain expected (STRING:STRING)
  'Não é permitido ter mais de 1 carrinho'
  'Não é permitido possuir produto duplicado'

classpath:serverest/carrinhos/Carts.feature:370
	at &lt;feature&gt;.: And match response.message contains 'Não é permitido possuir produto duplicado' (classpath:serverest/carrinhos/Carts.feature:370:370)

</failure></testcase>
<testcase classname="serverest.carrinhos.Carts" name="CT08 - Prevent cart creation with non-existing product" time="0.919063"><system-out>* url 'https://serverest.dev' ............................................. passed
* def FakerUtils = Java.type('serverest.utils.FakerUtils') ................ passed
* def randomProductName = function(){ return FakerUtils.randomProduct() } . passed
* def loginPayload = read('classpath:serverest/login/resources/loginPayload.json') . passed
* def email = function(){ return FakerUtils.randomEmail() } ............... passed
* def loginPayload = read('classpath:serverest/login/resources/loginPayload.json') . passed
Given path '/login' ....................................................... passed
And request loginPayload .................................................. passed
When method POST .......................................................... passed
Then status 200 ........................................................... passed
* def token = response.authorization ...................................... passed
Given path '/carrinhos/cancelar-compra' ................................... passed
And header Authorization = token .......................................... passed
When method DELETE ........................................................ passed
Then status 200 ........................................................... passed
* def invalidCartBody = ................................................... passed
Given path '/carrinhos' ................................................... passed
And header Authorization = token .......................................... passed
And request invalidCartBody ............................................... passed
When method POST .......................................................... passed
Then status 400 ........................................................... passed
And match response.message contains 'Produto não encontrado' .............. passed
</system-out></testcase>
</testsuite>