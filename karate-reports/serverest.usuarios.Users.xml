<testsuite failures="1" name="serverest/usuarios/Users.feature" skipped="0" tests="14" time="4.2327"><testcase classname="serverest.usuarios.Users" name="CT01 - List all users and validate JSON structure" time="0.488837"><system-out>* url 'https://serverest.dev' ............................................. passed
* def FakerUtils = Java.type('serverest.utils.FakerUtils') ................ passed
* def randomEmail = function(){ return FakerUtils.randomEmail() } ......... passed
* def randomName = function(){ return FakerUtils.randomName() } ........... passed
* def randomPassword = function(){ return FakerUtils.randomPassword() } ... passed
* def newEmail = randomEmail() ............................................ passed
* def newName = randomName() .............................................. passed
* def newPassword = randomPassword() ...................................... passed
* def userData = .......................................................... passed
Given path '/usuarios' .................................................... passed
When method GET ........................................................... passed
Then status 200 ........................................................... passed
And match response == ..................................................... passed
And match response.quantidade == '#number? _ &gt; 0' ......................... passed
And match response.usuarios == '#[_ &gt; 0]' ................................. passed
And match each response.usuarios == ....................................... passed
And match each response.usuarios contains { administrador: '#regex true|false' } . passed
* def firstUser = response.usuarios[0] .................................... passed
* print 'First user:', firstUser .......................................... passed
</system-out></testcase>
<testcase classname="serverest.usuarios.Users" name="CT02 - Get a specific user by ID" time="0.499449"><system-out>* url 'https://serverest.dev' ............................................. passed
* def FakerUtils = Java.type('serverest.utils.FakerUtils') ................ passed
* def randomEmail = function(){ return FakerUtils.randomEmail() } ......... passed
* def randomName = function(){ return FakerUtils.randomName() } ........... passed
* def randomPassword = function(){ return FakerUtils.randomPassword() } ... passed
* def newEmail = randomEmail() ............................................ passed
Given path '/usuarios' .................................................... passed
When method GET ........................................................... passed
Then status 200 ........................................................... passed
* def userId = response.usuarios[0]._id ................................... passed
Given path '/usuarios/' + userId .......................................... passed
When method GET ........................................................... passed
Then status 200 ........................................................... passed
And match response contains ............................................... passed
And match response.nome == '#string' ...................................... passed
And match response.email == '#string' ..................................... passed
And match response._id == userId .......................................... passed
And match response == { nome: '#string', email: '#string', password: '#string', administrador: '#string', _id: '#string' } . passed
</system-out></testcase>
<testcase classname="serverest.usuarios.Users" name="CT03 - Create a new user with complete validations" time="0.509148"><system-out>* url 'https://serverest.dev' ............................................. passed
* def FakerUtils = Java.type('serverest.utils.FakerUtils') ................ passed
* def randomEmail = function(){ return FakerUtils.randomEmail() } ......... passed
* def randomName = function(){ return FakerUtils.randomName() } ........... passed
* def randomPassword = function(){ return FakerUtils.randomPassword() } ... passed
* def newEmail = randomEmail() ............................................ passed
* def name = randomName() ................................................. passed
* def password = randomPassword() ......................................... passed
* def userData = .......................................................... passed
Given path '/usuarios' .................................................... passed
And request userData ...................................................... passed
When method POST .......................................................... passed
Then status 201 ........................................................... passed
And match response.message == 'Cadastro realizado com sucesso' ............ passed
And match response._id == '#string' ....................................... passed
And match response._id == '#notnull' ...................................... passed
* def newUserId = response._id ............................................ passed
Given path '/usuarios/' + newUserId ....................................... passed
When method GET ........................................................... passed
Then status 200 ........................................................... passed
And match response.nome == name ........................................... passed
And match response.email == newEmail ...................................... passed
</system-out></testcase>
<testcase classname="serverest.usuarios.Users" name="CT04 - Advanced JSON validations with filters" time="0.417603"><system-out>* url 'https://serverest.dev' ............................................. passed
* def FakerUtils = Java.type('serverest.utils.FakerUtils') ................ passed
* def randomEmail = function(){ return FakerUtils.randomEmail() } ......... passed
* def randomName = function(){ return FakerUtils.randomName() } ........... passed
* def randomPassword = function(){ return FakerUtils.randomPassword() } ... passed
Given path '/usuarios' .................................................... passed
When method GET ........................................................... passed
Then status 200 ........................................................... passed
* def admins = karate.filter(response.usuarios, function(x){ return x.administrador == 'true' }) . passed
* print 'Total administrators:', admins.length ............................ passed
And match admins == '#[_ &gt; 0]' ............................................ passed
* def filteredUsers = karate.jsonPath(response, "$.usuarios[?(@.administrador=='true')]") . passed
* print 'Admin users found:', filteredUsers.length ........................ passed
* def emails = karate.map(response.usuarios, function(x){ return x.email }) . passed
* print 'List of emails:', emails ......................................... passed
And match emails == '#[] #string' ......................................... passed
</system-out></testcase>
<testcase classname="serverest.usuarios.Users" name="CT05 - Validate error messages when creating a duplicate email" time="0.39285"><system-out>* url 'https://serverest.dev' ............................................. passed
* def FakerUtils = Java.type('serverest.utils.FakerUtils') ................ passed
* def randomEmail = function(){ return FakerUtils.randomEmail() } ......... passed
* def randomName = function(){ return FakerUtils.randomName() } ........... passed
* def randomPassword = function(){ return FakerUtils.randomPassword() } ... passed
* def duplicateEmail = randomEmail() ...................................... passed
* def user1 = ............................................................. passed
Given path '/usuarios' .................................................... passed
And request user1 ......................................................... passed
When method POST .......................................................... passed
Then status 201 ........................................................... passed
* def user2 = ............................................................. passed
Given path '/usuarios' .................................................... passed
And request user2 ......................................................... passed
When method POST .......................................................... passed
Then status 400 ........................................................... passed
And match response == ..................................................... passed
And match response.message == '#notnull' .................................. passed
</system-out></testcase>
<testcase classname="serverest.usuarios.Users" name="CT06 - Validate with fuzzy matching" time="0.157938"><system-out>* url 'https://serverest.dev' ............................................. passed
* def FakerUtils = Java.type('serverest.utils.FakerUtils') ................ passed
* def randomEmail = function(){ return FakerUtils.randomEmail() } ......... passed
* def randomName = function(){ return FakerUtils.randomName() } ........... passed
* def randomPassword = function(){ return FakerUtils.randomPassword() } ... passed
Given path '/usuarios' .................................................... passed
And param administrador = 'true' .......................................... passed
When method GET ........................................................... passed
Then status 200 ........................................................... passed
And match response == ..................................................... passed
And match each response.usuarios contains ................................. passed
</system-out></testcase>
<testcase classname="serverest.usuarios.Users" name="CT07 - Conditional validations based on values" time="0.143078"><system-out>* url 'https://serverest.dev' ............................................. passed
* def FakerUtils = Java.type('serverest.utils.FakerUtils') ................ passed
* def randomEmail = function(){ return FakerUtils.randomEmail() } ......... passed
* def randomName = function(){ return FakerUtils.randomName() } ........... passed
* def randomPassword = function(){ return FakerUtils.randomPassword() } ... passed
Given path '/usuarios' .................................................... passed
When method GET ........................................................... passed
Then status 200 ........................................................... passed
* def user = response.usuarios[0] ......................................... passed
* if (user.administrador == 'true') karate.log('User is an administrator') . passed
* if (user.administrador == 'false') karate.log('User is not an administrator') . passed
And match user.email == '#? _.length &gt; 5' ................................. passed
And match user.password == '#? _.length &gt; 0' .............................. passed
</system-out></testcase>
<testcase classname="serverest.usuarios.Users" name="CT08 - Validate formats with regular expressions" time="0.297681"><system-out>* url 'https://serverest.dev' ............................................. passed
* def FakerUtils = Java.type('serverest.utils.FakerUtils') ................ passed
* def randomEmail = function(){ return FakerUtils.randomEmail() } ......... passed
* def randomName = function(){ return FakerUtils.randomName() } ........... passed
* def randomPassword = function(){ return FakerUtils.randomPassword() } ... passed
* def newEmail = 'test.regex.' + new Date().getTime() + '@example.com' .... passed
* def userData = .......................................................... passed
Given path '/usuarios' .................................................... passed
And request userData ...................................................... passed
When method POST .......................................................... passed
Then status 201 ........................................................... passed
Given path '/usuarios/' + response._id .................................... passed
When method GET ........................................................... passed
Then status 200 ........................................................... passed
And match response.email == '#regex .+@.+\\..+' ........................... passed
And match response.nome == '#regex [A-Za-z\\s]+' .......................... passed
And match response._id == '#regex [A-Za-z0-9]+' ........................... passed
</system-out></testcase>
<testcase classname="serverest.usuarios.Users" name="CT09 - Validate absence of fields" time="0.163282"><system-out>* url 'https://serverest.dev' ............................................. passed
* def FakerUtils = Java.type('serverest.utils.FakerUtils') ................ passed
* def randomEmail = function(){ return FakerUtils.randomEmail() } ......... passed
* def randomName = function(){ return FakerUtils.randomName() } ........... passed
* def randomPassword = function(){ return FakerUtils.randomPassword() } ... passed
Given path '/usuarios' .................................................... passed
When method GET ........................................................... passed
Then status 200 ........................................................... passed
And match response !contains { error: '#string' } ......................... passed
And match response !contains { errorMessage: '#string' } .................. passed
* def user = response.usuarios[0] ......................................... passed
And match user !contains { cpf: '#string' } ............................... passed
And match user !contains { phone: '#string' } ............................. passed
</system-out></testcase>
<testcase classname="serverest.usuarios.Users" name="CT10 - Use variables for dynamic validations" time="0.247805"><system-out>* url 'https://serverest.dev' ............................................. passed
* def FakerUtils = Java.type('serverest.utils.FakerUtils') ................ passed
* def randomEmail = function(){ return FakerUtils.randomEmail() } ......... passed
* def randomName = function(){ return FakerUtils.randomName() } ........... passed
* def randomPassword = function(){ return FakerUtils.randomPassword() } ... passed
* def expectedEmail = randomEmail() ....................................... passed
* def userPayload = read('resources/userPayload.json') .................... passed
* userPayload.email = expectedEmail ....................................... passed
Given path '/usuarios' .................................................... passed
And request userPayload ................................................... passed
When method POST .......................................................... passed
Then status 201 ........................................................... passed
Given path '/usuarios' .................................................... passed
And param email = expectedEmail ........................................... passed
When method GET ........................................................... passed
Then status 200 ........................................................... passed
* def user = response.usuarios[0] ......................................... passed
And match user.email == expectedEmail ..................................... passed
And match user contains { email: '#(expectedEmail)', nome: '#string' } .... passed
</system-out></testcase>
<testcase classname="serverest.usuarios.Users" name="CT11 - Prepare data for nested object validation" time="0.123159"><system-out>* url 'https://serverest.dev' ............................................. passed
* def FakerUtils = Java.type('serverest.utils.FakerUtils') ................ passed
* def randomEmail = function(){ return FakerUtils.randomEmail() } ......... passed
* def randomName = function(){ return FakerUtils.randomName() } ........... passed
* def randomPassword = function(){ return FakerUtils.randomPassword() } ... passed
* def complexData = ....................................................... passed
Given path '/usuarios' .................................................... passed
And request complexData ................................................... passed
When method POST .......................................................... passed
Then status 201 ........................................................... passed
And match response == ..................................................... passed
And match response.message == 'Cadastro realizado com sucesso' ............ passed
And match response._id == '#? _.length &gt; 10' .............................. passed
</system-out></testcase>
<testcase classname="serverest.usuarios.Users" name="CT12 - Create a user from fixed JSON file" time="0.110788"><system-out>* url 'https://serverest.dev' ............................................. passed
* def FakerUtils = Java.type('serverest.utils.FakerUtils') ................ passed
* def randomEmail = function(){ return FakerUtils.randomEmail() } ......... passed
* def randomName = function(){ return FakerUtils.randomName() } ........... passed
* def randomPassword = function(){ return FakerUtils.randomPassword() } ... passed
* def userPayload = read('resources/userPayload.json') .................... passed
* userPayload.email = randomEmail() ....................................... passed
Given path '/usuarios' .................................................... passed
And request userPayload ................................................... passed
When method POST .......................................................... passed
Then status 201 ........................................................... passed
And match response.message == 'Cadastro realizado com sucesso' ............ passed
And match response._id == '#string' ....................................... passed
</system-out></testcase>
<testcase classname="serverest.usuarios.Users" name="CT13 - Create and delete user based on JSON payload" time="0.35675"><system-out>* url 'https://serverest.dev' ............................................. passed
* def FakerUtils = Java.type('serverest.utils.FakerUtils') ................ passed
* def randomEmail = function(){ return FakerUtils.randomEmail() } ......... passed
* def randomName = function(){ return FakerUtils.randomName() } ........... passed
* def randomPassword = function(){ return FakerUtils.randomPassword() } ... passed
* def expectedEmail = randomEmail() ....................................... passed
* def userPayload = read('resources/userPayload.json') .................... passed
* userPayload.email = expectedEmail ....................................... passed
Given path '/usuarios' .................................................... passed
And request userPayload ................................................... passed
When method POST .......................................................... passed
Then status 201 ........................................................... passed
And match response.message == 'Cadastro realizado com sucesso' ............ passed
* def userId = response._id ............................................... passed
Given path '/usuarios/' + userId .......................................... passed
When method DELETE ........................................................ passed
Then status 200 ........................................................... passed
And match response.message == 'Registro excluído com sucesso' ............. passed
Given path '/usuarios' .................................................... passed
And param email = expectedEmail ........................................... passed
When method GET ........................................................... passed
Then status 200 ........................................................... passed
And match response.quantidade == 0 ........................................ passed
And match response.usuarios == '#[0]' ..................................... passed
</system-out></testcase>
<testcase classname="serverest.usuarios.Users" name="CT14 - Prevent deleting user that has an associated cart" time="0.324332"><failure message="status code was: 403, expected: 201, response time in milliseconds: 97, url: https://serverest.dev/produtos, response: &#10;{&#10;    &quot;message&quot;: &quot;Rota exclusiva para administradores&quot;&#10;}&#10;classpath:serverest/usuarios/Users.feature:388">* url 'https://serverest.dev' ............................................. passed
* def FakerUtils = Java.type('serverest.utils.FakerUtils') ................ passed
* def randomEmail = function(){ return FakerUtils.randomEmail() } ......... passed
* def randomName = function(){ return FakerUtils.randomName() } ........... passed
* def randomPassword = function(){ return FakerUtils.randomPassword() } ... passed
* def userEmail = randomEmail() ........................................... passed
* def userPassword = 'SenhaSegura@123' .................................... passed
* def userData = .......................................................... passed
Given path '/usuarios' .................................................... passed
And request userData ...................................................... passed
When method POST .......................................................... passed
Then status 201 ........................................................... passed
And match response.message == 'Cadastro realizado com sucesso' ............ passed
* def userId = response._id ............................................... passed
* def loginPayload = ...................................................... passed
Given path '/login' ....................................................... passed
And request loginPayload .................................................. passed
When method POST .......................................................... passed
Then status 200 ........................................................... passed
* def userToken = response.authorization .................................. passed
* def adminToken = userToken .............................................. passed
* def productName = 'Product for user cart ' + new Date().getTime() ....... passed
* def productData = ....................................................... passed
Given path '/produtos' .................................................... passed
And header Authorization = adminToken ..................................... passed
And request productData ................................................... passed
When method POST .......................................................... passed
Then status 201 ........................................................... failed

Stack Trace:
com.intuit.karate.KarateException: status code was: 403, expected: 201, response time in milliseconds: 97, url: https://serverest.dev/produtos, response: 
{
    "message": "Rota exclusiva para administradores"
}
classpath:serverest/usuarios/Users.feature:388
	at &lt;feature&gt;.: Then status 201 (classpath:serverest/usuarios/Users.feature:388:388)

* def productId = response._id ............................................ skipped
Given path '/carrinhos/cancelar-compra' ................................... skipped
And header Authorization = userToken ...................................... skipped
When method DELETE ........................................................ skipped
Then status 200 ........................................................... skipped
* def cartBody = .......................................................... skipped
Given path '/carrinhos' ................................................... skipped
And header Authorization = userToken ...................................... skipped
And request cartBody ...................................................... skipped
When method POST .......................................................... skipped
Then status 201 ........................................................... skipped
Given path '/usuarios/' + userId .......................................... skipped
When method DELETE ........................................................ skipped
Then status 400 ........................................................... skipped
And match response.message == 'Não é permitido excluir usuário com carrinho cadastrado' . skipped
And match response.idCarrinho == '#string' ................................ skipped
</failure></testcase>
</testsuite>